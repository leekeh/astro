---
import Layout from '../layouts/Layout.astro';
---

<script type="module" is:inline>
	document.addEventListener('DOMContentLoaded', () => {
		const form = document.querySelector('form');
		if (!form) throw new Error('Form not found');
		form.addEventListener('submit', (e) => {
			e.preventDefault();
			const formData = new FormData(form);
			const data = Object.fromEntries(formData);

			fetch('/login.form.async', {
				method: 'POST',
				body: JSON.stringify(data),
			})
				.then((res) => res.json())
				.then(() => {
					const result = document.querySelector('#result');
					if (result) {
						result.innerHTML =
							'Progressive login was successful! you will be redirected to the store in 3 seconds';
						setTimeout(() => (location.href = '/'), 3000);
					}
				});
		});
	});
</script>

<Layout title="login">
	<p>You must be logged in to view the secret page. Enter your details below.</p>

	<p>Test validation: password shorter than 5 characters will be rejected.</p>
	<form action="/login.form" method="POST">
		<label for="name">Name</label>
		<input type="text" name="name" />

		<label for="password">Password</label>
		<input type="password" name="password" />

		<input type="submit" value="Submit" />
	</form>
	<div id="result"></div>
</Layout>
